<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Eichhörnchen Sortierspiel</title>
  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: #ffffff;
      font-family: system-ui, sans-serif;
    }

    /* Whole page: forest on top, animals at bottom */
    .page {
      height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
    }

    .forest-area {
      flex: 0 0 60%;          /* smaller than before */
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px;
    }

    .forest-area img {
      width: 90%;
      height: 100%;
      object-fit: cover;
      border-radius: 10px;
      display: block;
    }

    .animals-area {
      flex: 0 0 40%;
      padding: 10px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 10px;
      position: relative;
      z-index: 1;
    }

    .card {
      width: 120px;
      height: 120px;
      cursor: grab;
      user-select: none;
      touch-action: none;
    }

    .card img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      pointer-events: none;
    }

    .card.dragging {
      transform: scale(1.1);
      z-index: 999;
      cursor: grabbing;
    }

    .feedback-overlay {
      position: fixed;
      inset: 0;
      display: none;
      justify-content: center;
      align-items: center;
      pointer-events: none;
    }

    .feedback-overlay img {
      width: 30%;
      max-width: 220px;
      height: auto;
      pointer-events: auto;
      cursor: pointer;
      user-select: none;
    }
  </style>
</head>
<body>
  <div class="page" id="page-root">
    <div class="forest-area">
      <img src="https://i.postimg.cc/s2V0k6gc/Freunde-und-Feinde-Eichhornchen.png" alt="">
    </div>

    <div class="animals-area" id="animals-area">
      <!-- cards created by JS -->
    </div>

    <div class="feedback-overlay" id="feedback">
      <img id="feedback-img" alt="">
    </div>
  </div>

  <script>
    const CARD_SIZE = 120;

    // 1–8 = Freunde, 9–15 = Feinde
    const cardsData = [
      { id: 1, type: "freund", src: "https://i.postimg.cc/LY4JvcjD/1.png" },
      { id: 2, type: "freund", src: "https://i.postimg.cc/vg84XJ5N/2.png" },
      { id: 3, type: "freund", src: "https://i.postimg.cc/DJfS59qK/3.png" },
      { id: 4, type: "freund", src: "https://i.postimg.cc/Q9NFS2ps/4.png" },
      { id: 5, type: "freund", src: "https://i.postimg.cc/YG2v8517/5.png" },
      { id: 6, type: "freund", src: "https://i.postimg.cc/mzZPVvQL/6.png" },
      { id: 7, type: "freund", src: "https://i.postimg.cc/cg1vTpQH/7.png" },
      { id: 8, type: "freund", src: "https://i.postimg.cc/dkWLf5BF/8.png" },

      { id: 9,  type: "feind", src: "https://i.postimg.cc/R6PNYgR4/9.png" },
      { id: 10, type: "feind", src: "https://i.postimg.cc/TLkpst9Y/10.png" },
      { id: 11, type: "feind", src: "https://i.postimg.cc/gXMn7gDz/11.png" },
      { id: 12, type: "feind", src: "https://i.postimg.cc/XG2pPs8v/12.png" },
      { id: 13, type: "feind", src: "https://i.postimg.cc/ZBfCQwcR/13.png" },
      { id: 14, type: "feind", src: "https://i.postimg.cc/dkWLf5BL/14.png" },
      { id: 15, type: "feind", src: "https://i.postimg.cc/JDTGFpqy/15.png" }
    ];

    const pageRoot    = document.getElementById("page-root");
    const animalsArea = document.getElementById("animals-area");
    const feedback    = document.getElementById("feedback");
    const feedbackImg = document.getElementById("feedback-img");

    const FEEDBACK_IMAGES = {
      falsch: "https://i.postimg.cc/zLsKJzHC/falsch.png",
      feind:  "https://i.postimg.cc/p9wz2W5Y/feinde.png",
      freund: "https://i.postimg.cc/B8rHqSP5/freunde.png"
    };

    // Remember original bottom positions
    const originalPositions = new Map(); // card -> {left, top}
    const anchored = new Set();         // cards already converted to absolute

    function init() {
      // create cards in bottom area
      cardsData.forEach(data => {
        const card = document.createElement("div");
        card.className = "card";
        card.dataset.type = data.type;
        card.dataset.id   = data.id;

        const img = document.createElement("img");
        img.src = data.src;
        img.alt = "";
        card.appendChild(img);

        animalsArea.appendChild(card);
        makeDraggable(card);
      });

      // after layout, we know their positions
      requestAnimationFrame(recordInitialPositions);
    }

    function recordInitialPositions() {
      const pageRect = pageRoot.getBoundingClientRect();
      const cards = document.querySelectorAll(".card");

      cards.forEach(card => {
        const rect = card.getBoundingClientRect();
        const left = rect.left - pageRect.left;
        const top  = rect.top  - pageRect.top;

        originalPositions.set(card, { left, top });
      });
    }

    function makeDraggable(card) {
      let offsetX = 0, offsetY = 0;

      card.addEventListener("pointerdown", (e) => {
        e.preventDefault();

        const pageRect = pageRoot.getBoundingClientRect();
        const rect = card.getBoundingClientRect();

        // first time: make absolute at its current bottom position
        if (!anchored.has(card)) {
          const left = rect.left - pageRect.left;
          const top  = rect.top  - pageRect.top;
          originalPositions.set(card, { left, top });

          card.style.position = "absolute";
          card.style.left = left + "px";
          card.style.top  = top  + "px";

          pageRoot.appendChild(card); // move out of flex container
          anchored.add(card);
        }

        const rectAbs = card.getBoundingClientRect();
        offsetX = e.clientX - rectAbs.left;
        offsetY = e.clientY - rectAbs.top;

        card.classList.add("dragging");
        card.setPointerCapture(e.pointerId);
      });

      card.addEventListener("pointermove", (e) => {
        if (!card.classList.contains("dragging")) return;

        const pageRect = pageRoot.getBoundingClientRect();
        let newLeft = e.clientX - pageRect.left - offsetX;
        let newTop  = e.clientY - pageRect.top  - offsetY;

        // keep fully inside pageRoot
        const maxLeft = pageRect.width  - CARD_SIZE;
        const maxTop  = pageRect.height - CARD_SIZE;
        newLeft = Math.max(0, Math.min(maxLeft, newLeft));
        newTop  = Math.max(0, Math.min(maxTop,  newTop));

        card.style.left = newLeft + "px";
        card.style.top  = newTop  + "px";
      });

      card.addEventListener("pointerup", (e) => {
        if (!card.classList.contains("dragging")) return;

        card.classList.remove("dragging");
        card.releasePointerCapture(e.pointerId);

        const pageRect = pageRoot.getBoundingClientRect();
        const rect = card.getBoundingClientRect();
        const centerX = (rect.left + rect.right) / 2 - pageRect.left;
        const midX = pageRect.width / 2;

        const type = card.dataset.type;

        let feedbackType;
        if (centerX < midX && type === "feind") {
          feedbackType = "feind";
        } else if (centerX >= midX && type === "freund") {
          feedbackType = "freund";
        } else {
          feedbackType = "falsch";
          // snap back to original bottom position
          const orig = originalPositions.get(card);
          if (orig) {
            card.style.left = orig.left + "px";
            card.style.top  = orig.top  + "px";
          }
        }

        showFeedback(feedbackType);
      });
    }

    function showFeedback(type) {
      feedbackImg.src = FEEDBACK_IMAGES[type];
      feedback.style.display = "flex";
    }

    feedbackImg.addEventListener("click", () => {
      feedback.style.display = "none";
    });

    window.addEventListener("load", init);
  </script>
</body>
</html>

